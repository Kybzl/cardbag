<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- æ–°å¢ç§»åŠ¨ç«¯metaæ ‡ç­¾ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta charset="UTF-8">
    <title>çƒæ˜Ÿå¡åŒ…æŠ½å¥–</title>
    <style>
    /* åœ¨æ ·å¼è¡¨å¼€å¤´æ·»åŠ å…¨å±€è§¦æ‘¸æ§åˆ¶ */
    html,
    body {
        touch-action: manipulation;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
	padding-bottom: 50px; /* ä¸ºé¡µè„šç•™å‡ºç©ºé—´ */
    }

    /* ä¸ºæ‰€æœ‰å¯äº¤äº’å…ƒç´ æ·»åŠ ç²¾ç»†æ§åˆ¶ */
    .cell,
    button {
        touch-action: manipulation;
    }

    /* ç§»é™¤ç§»åŠ¨ç«¯é•¿æŒ‰èœå• */
    * {
        -webkit-tap-highlight-color: transparent;
    }

        .container {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            gap: 10px;
            margin: 20px auto;
            width: 340px;
        }
        .cell {
            width: 100px;
            height: 100px;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background-color: #fff;
            transition: all 0.3s;
            transform: scale(1);
            transition: 
                transform 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                background-color 0.3s ease,
                opacity 0.3s ease;
        }

        .cell.disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .cell.prob-up { background-color: #FFD700; }
        .cell.ability-up { background-color: #90EE90; }
        .cell.tear { background-color: #FF6347; }
        .status {
            text-align: center;
            margin: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            gap: 10px;
            margin: 20px auto;
            width: 340px;
        }

        .cell {
            width: 100px;
            height: 100px;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background-color: #fff;
            transition: all 0.3s;
        }

        /* æ–°å¢ä»“åº“æ ·å¼ */
        .warehouse {
            max-width: 400px;
            margin: 20px auto;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .warehouse h3 {
            margin: 0 0 10px;
            color: #333;
        }

        .record-item {
            padding: 8px;
            margin: 5px 0;
            background: #f8f8f8;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .record-item.golden {
            background: #fff9e6;
            color: #ffd700;
            font-weight: bold;
        }

        .timestamp {
            font-size: 0.8em;
            color: #666;
        }

        .cell:active:not(.disabled) {
            transform: scale(0.95);
        }

        .cell.hover-effect:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* ä¼˜åŒ–ç¿»è½¬åŠ¨ç”» */
        @keyframes flipIn {
            0% {
                transform: rotateY(90deg);
                opacity: 0;
            }
            100% {
                transform: rotateY(0deg);
                opacity: 1;
            }
        }

        .cell.disabled {
            animation: flipIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        /* æ–°å¢åŠ è½½æŒ‡ç¤ºå™¨ */
        .loading::after {
            content: "";
            position: absolute;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

@media (hover: none) {
    .cell {
        min-height: 80px;
        touch-action: manipulation;
    }
}

    /* ä¼˜åŒ–è¿‡æ¸¡å±æ€§ */
    .cell {
        will-change: transform, opacity;
        transition: 
            transform 0.15s cubic-bezier(0.4, 0, 0.2, 1),
            background-color 0.3s ease,
            opacity 0.3s ease;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
    }

    /* ä¼˜åŒ–æŒ‰é’®ç‚¹å‡»åé¦ˆ */
    button {
        transition: opacity 0.2s ease;
        -webkit-tap-highlight-color: transparent;
    }

    /* ç§»é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é˜´å½± */
    @media (hover: none) {
        .cell.hover-effect:hover {
            box-shadow: none;
            transform: none;
        }
    }

       .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        max-width: 100%;
        text-align: center;
        padding: 15px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 0;
        border: none;
        backdrop-filter: blur(5px);
        margin-top: 0;
        z-index: 10;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
        color: #fdbb2d;
        font-size: 15px;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }
        
        .footer::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #fdbb2d, transparent);
        }
        
        .footer i {
            color: #b21f1f;
            font-size: 18px;
        }

    </style>
</head>
<body>
    <div class="status">
        <p>å½“å‰èƒ½åŠ›å€¼ï¼š<span id="ability">96</span></p>
        <p>å½“å‰æ¦‚ç‡ï¼š<span id="probability">5%</span></p>
        <p>å·²æŠ½æ¬¡æ•°ï¼š<span id="draw-count">0</span></p>
    </div>

    <div class="container" id="grid"></div>

    <div class="status">
        <button onclick="resetGame()">é‡ç½®å¡åŒ…</button>
    </div>

    <!-- æ–°å¢ä»“åº“åŒºåŸŸ -->
    <div class="warehouse">
        <h3>ğŸ“¦ çƒå‘˜ä»“åº“ï¼ˆæœ€è¿‘20æ¡ï¼‰</h3>
        <div id="warehouse-list"></div>
    </div>

    <div class="footer">
        <i class="fas fa-user"></i>@å¤§ä¼—è¯„çƒ | ä¸å‡ºç»´åŸƒæ‹‰ä¸æ”¹å(å·²å…‘æ¢) 
    </div>

<audio id="click-sound" src="click.mp3"></audio>	

    <script>
	// åœ¨è„šæœ¬å¼€å¤´æ·»åŠ è§¦æ‘¸äº‹ä»¶æ£€æµ‹
	let isTouchDevice = 'ontouchstart' in window;
    
// åœ¨è„šæœ¬å¼€å¤´æ·»åŠ è§¦æ‘¸äº‹ä»¶å¤„ç†
    document.addEventListener('touchstart', function(e) {
        if (e.touches.length > 1) {
            e.preventDefault()
        }
    }, { passive: false })

    document.addEventListener('dblclick', function(e) {
        e.preventDefault()
    })

	function playSound(type) {
    const sounds = {
        'prob-up': 'boost.mp3',
        'ability-up': 'powerup.mp3',
        'tear': 'tear.mp3'
    };
    const audio = new Audio(sounds[type]);
    audio.play();
}

        const cardPool = {
            101: ['åŒå¢èƒ½å¡çº³ç“¦ç½—', 'åŒå¢èƒ½åŸƒæ‰˜å¥¥', 'åŒå¢èƒ½é‡Œæ°å¡å°”å¾·', 'åŒå¢èƒ½è²æˆˆ'],
            100: ["åŒå¢èƒ½åé€šçº³", "åŒå¢èƒ½å¾·ç§‘", "å•å¢èƒ½å…‹é²ä¼Šå¤«", "åŒå¢èƒ½å›¾æ‹‰å§†", 
                 "åŒå¢èƒ½æ¢…è¥¿", "å•å¢èƒ½ä¸–ç•Œæ¯æ¢…è¥¿",  "åŒå¢èƒ½èŒƒå·´æ–¯æ»•",
                 "å•å¢èƒ½æ™®æ‹‰è’‚å°¼", "åŒå¢èƒ½å¡æ´›æ–¯", "åŒå¢èƒ½ç½—çº³å°”è¿ªå°¼å¥¥", "å•å¢èƒ½æµç§‘","åŒå¢èƒ½è¿ªè¾¾",, 'åŒå¢èƒ½é²æ¢…å°¼æ ¼', 'åŒå¢èƒ½èˆ’æ¢…åˆ‡å°”', 'åŒå¢èƒ½è‹äºšé›·æ–¯', 'åŒå¢èƒ½å†…é©¬å°”', 'åŒå¢èƒ½å¡å¡', 'åŒå¢èƒ½å¸ƒå†¯', 'åŒå¢èƒ½æ‹‰å§†', 'åŒå¢èƒ½æ‰˜è’‚', 'åŒå¢èƒ½å¤åˆ©ç‰¹', 'åŒå¢èƒ½èŒƒå·´æ–¯æ»•', 'åŒå¢èƒ½æ™®æ‹‰è’‚å°¼', 'åŒå¢èƒ½é˜¿æ‰å°”', 'åŒå¢èƒ½åŸºè€¶åˆ©å°¼', 'åŒå¢èƒ½å¸ƒæ–¯å…‹èŒ¨', 'åŒå¢èƒ½ç»´è€¶é‡Œ', 'åŒå¢èƒ½é‡Œè´é‡Œ', 'åŒå¢èƒ½çš®å°”æ´›', 'åŒå¢èƒ½é©¬å°”è’‚å°¼', 'åŒå¢èƒ½æµç§‘', 'åŒå¢èƒ½ç»´åŸƒæ‹‰'],
            99: ["åŒå¢èƒ½è´¹é›·å°”", 'åŒå¢èƒ½è¨å†…è’‚', 'åŒå¢èƒ½è´å…‹æ±‰å§†', 'åŒå¢èƒ½äºšäºšå›¾é›·', 'åŒå¢èƒ½æ‰¬ç§‘å‹’', 'åŒå¢èƒ½åŠ å›¾ç´¢', 'åŒå¢èƒ½æ‰˜é›·æ–¯', 'åŒå¢èƒ½æ¬§æ–‡', 'åŒå¢èƒ½é˜¿å°”å·´', 'åŒå¢èƒ½å› æ‰å‰', 'åŒå¢èƒ½é˜¿å°”è´è’‚å°¼', 'åŒå¢èƒ½è¥¿å¤šå¤«', "å•å¢èƒ½çš®è€¶ç½—", "å•å¢èƒ½çš®å°”æ´›", "å•å¢èƒ½èˆç”«ç´ç§‘",
                "å•å¢èƒ½é©¬å…‹è±è±", "å•å¢èƒ½è´å…‹æ±‰å§†", "å•å¢èƒ½æ‰˜è’‚","å•å¢èƒ½æ¯”åˆ©äºš","å•å¢èƒ½åšæ ¼åæ™®","å•å¢èƒ½å¾·ç½—å·´","å•å¢èƒ½è´å°”","å•å¢èƒ½å…°å¸•å¾·","å•å¢èƒ½é‡Œè´é‡Œ","å•å¢èƒ½è´éš†","å•å¢èƒ½é²æ¢…å°¼æ ¼","å•å¢èƒ½å¡æ©","å•å¢èƒ½é©¬å°”è’‚å°¼","å•å¢èƒ½ç»´åŸƒæ‹‰","å•å¢èƒ½å†…å¾·ç»´å¾·","å•å¢èƒ½èˆ’æ¢…åˆ‡å°”","å•å¢èƒ½åˆ‡èµ«","å•å¢èƒ½å·´ä¹”","åŒå¢èƒ½èµ«å†…æ–¯",/* å…¶ä»–99åˆ†çƒå‘˜ */],
            98: ["åŒå¢èƒ½åšæ‰¬", "å•å¢èƒ½å› æ‰å‰", "å•å¢èƒ½å·´è’‚æ–¯å›¾å¡”", "å•å¢èƒ½å¤è’‚","å•å¢èƒ½ä¼Šæ¶…æ–¯å¡”","å•å¢èƒ½é˜¿å°”è´è’‚å°¼","å•å¢èƒ½è¥¿å¤šå¤«","å•å¢èƒ½é©¬å…‹è±è±","å•å¢èƒ½å¼—å…°","å•å¢èƒ½æˆ´ç»´æ–¯","å•å¢èƒ½åŸƒå¾·ç±³å°”æ£®","å•å¢èƒ½æ‰˜é›·æ–¯","å•å¢èƒ½å¡å¡","å•å¢èƒ½åŠ³å°”", /* å…¶ä»–98åˆ†çƒå‘˜ */],
            97: ["å•å¢èƒ½ç§‘æ–¯å¡”åº“å¡”","å•å¢èƒ½è´è±è’‚","å•å¢èƒ½åˆ©æ‰æ‹‰ç¥–","å•å¢èƒ½ç½—å¸ƒæ£®","å•å¢èƒ½çš®è¨ç½—","å•å¢èƒ½èŒƒæ¯”æ»•","å•å¢èƒ½å¼—è±å½»","å•å¢èƒ½è¥¿æ›¼","å•å¢èƒ½åŸƒå°”æ–‡","å•å¢èƒ½å¾·å°¼å°”æ£®","å•å¢èƒ½æ–¯æ‰˜ä¼Šç§‘ç»´å¥‡","å•å¢èƒ½çº¦å…‹","å•å¢èƒ½åŸƒå¾·ç±³å°”æ£®","å•å¢èƒ½ä½©è’‚ç‰¹","å•å¢èƒ½è«ä¼¦ç‰¹æ–¯","åŒå¢èƒ½åˆ‡å°”è¥¿æ‰˜é›·æ–¯","å•å¢èƒ½æ°¸è´é‡Œ","å•å¢èƒ½æ‰¬ç§‘å‹’","å•å¢èƒ½è¨ç»´å¥¥æ‹‰","å•å¢èƒ½è¿ªå…‹æ£®","å•å¢èƒ½å®‰å¸ƒç½—è¥¿å°¼","å•å¢èƒ½æ¡‘æ‰˜æ–¯å†…é©¬å°”","å•å¢èƒ½å¡å°”å‰å¥¥","åŒå¢èƒ½ç“œè¿ªå¥¥æ‹‰","å•å¢èƒ½ç“œè¿ªå¥¥æ‹‰","å•å¢èƒ½é»˜ç‰¹è¨å…‹","å•å¢èƒ½èŒƒå¾·æ³•ç‰¹","å•å¢èƒ½å¤šçº³å¤šå°¼","å•å¢èƒ½ç½—é©¬é‡Œå¥¥","å•å¢èƒ½é˜¿éš†ç´¢","å•å¢èƒ½ç½—ä¼¯æ‰˜", /* å…¶ä»–97åˆ†çƒå‘˜ */],
            96: ["å²è¯—ç“œè¿ªå¥¥æ‹‰","å²è¯—å‰æ–‡","å²è¯—ä½©å°”å¡è¥¿"]
        };

        const currentPlayers = [
            'å­™å…´æ…œ', 'å“ˆé‡ŒÂ·å‡¯æ©', 'å¾·å¸ƒåŠ³å†…', 'è¨æ‹‰èµ«', 'èŒƒæˆ´å…‹',
                'å¸ƒé²è¯ºÂ·è´¹å°”å—å¾·æ–¯', 'åç‰¹', 'æ–¯ç‰¹æ—', 'é˜¿è¯ºå¾·', 'é©¬å†…',
                'æ‹‰ä»€ç¦å¾·', 'æ¡‘ä¹”', 'ç¦ç™»', 'æ ¼æ‹‰åˆ©ä»€', 'è©¹å§†æ–¯',
                'è’‚äºšæˆˆ', 'è‹¥æ—¥å°¼å¥¥', 'èŠ’ç‰¹', 'å¢å¡åº“', 'é½è€¶èµ«',
                'å•è¿ªæ ¼', 'é˜¿æ–¯çš®åˆ©å¥å¡”', 'çƒ­è‹æ–¯', 'æ´¥ç´ç§‘', 'æ´›é‡Œ',
                'å‡¯å°”Â·æ²ƒå…‹', 'é©¬èµ«é›·æ–¯', 'äº¬å¤šå®‰', 'ç½—å¾·é‡Œ', 'åŸƒå¾·æ£®', 
		'è¿ªäºšæ–¯', 'è´å°”çº³å¤šÂ·å¸­å°”ç“¦', 'è²å°”Â·ç¦ç™»', 'å¡å¡ç±³ç½—', 'ç“¦æ‹‰å†…',            
                'æ¡‘åˆ‡æ–¯', 'å„å¾·é«˜', 'è¨å¡', 'å¥¥å·´æ¢…æ‰¬', 'æ‹‰å¡æ³½ç‰¹',
                'æ‰˜é©¬æ–¯Â·å¸•å°”ç‰¹ä¼Š', 'æœ¬Â·æ€€ç‰¹', 'è’‚å°”å°¼', 'å²å¯†æ–¯Â·ç½—', 'æ´›å­”åŠ ',
                'å¯Œå®‰å¥æ´‹', 'é©¬ä¸å†…åˆ©', 'æ©å‡¯è’‚äºš', 'æ‹‰å§†æ–¯ä»£å°”', 'éœå°”ä¸',
                'æœ¬æ³½é©¬', 'è«å¾·é‡Œå¥‡', 'ç»´å°¼ä¿®æ–¯', 'åº“å°”å›¾ç“¦', 'é˜¿æ‹‰å·´',
                'å…‹ç½—æ–¯', 'å·´å°”éŸ¦å¾·', 'ç½—å¾·é‡Œæˆˆ', 'é˜¿æ£®è¥¿å¥¥', 'å¡é©¬æ–‡åŠ ',
                'ç±³åˆ©å”', 'å•è¿ªæ ¼', 'çº³ä¹”', 'å¡ç“¦å“ˆå°”', 'å·´æ–¯å…‹æ–¯',
                'æ¢…è¥¿', 'è±ä¸‡å¤šå¤«æ–¯åŸº', 'ä½©å¾·é‡Œ', 'åŠ ç»´', 'å¾·å®¹',
                'ç‰¹å°”æ–½ç‰¹æ ¹', 'é˜¿åŠ³éœ', 'å…‹é‡Œæ–¯æ»•æ£®', 'å­”å¾·', 'ç™»è´è±',
                'è´¹å…°Â·æ‰˜é›·æ–¯', 'æ‹‰è²å°¼äºš', 'å‡¯è¥¿', 'å¸ƒæ–¯å…‹èŒ¨', 'é˜¿å°”å·´',
                'æ ¼é‡Œå…¹æ›¼', 'è«æ‹‰å¡”', 'ç§‘å…‹', 'è¨ä¹Œå°”', 'ç•¥ä¼¦ç‰¹',
                'å¥¥å¸ƒæ‹‰å…‹', 'å¸Œé—¨å°¼æ–¯', 'å‹’é©¬å°”', 'å¡æ‹‰æ–¯ç§‘', 'å¾·ä¿ç½—',
                'è´¹åˆ©å…‹æ–¯', 'æ ¼åˆ—å…¹æ›¼', 'è‹äºšé›·æ–¯', 'å¡ç“¦å°¼', 'çš®å…‹',
                'é˜¿å°”ç»´æ–¯', 'æ™®ä¼Šæ ¼', 'å°¼ç§‘', 'åŠ è¥¿äºš', 'æ³•è’‚',
                'ç©†å‹’', 'åŸºç±³å¸Œ', 'è¯ºä¼Šå°”', 'è¨å†…', 'æ ¼çº³å¸ƒé‡Œ',
                'æˆ´ç»´æ–¯', 'å¢å¡æ–¯Â·åŸƒå°”å—å¾·æ–¯', 'å¸•ç“¦å°”', 'æ ¼é›·èŒ¨å¡', 'é©¬å†…',
                'å¾·é‡Œèµ«ç‰¹', 'åå¡æ´›', 'ç§‘æ›¼', 'ç´¢é»˜', 'äºå¸•æ¢…å¡è¯º',
                'å“ˆå…°å¾·', 'è´æ—å„å§†', 'ç½—ä¼Šæ–¯', 'å¸ƒå…°ç‰¹', 'é˜¿åå‰'
        ];

        let state = {
            ability: 96,
            baseProbability: 5,
            probabilityStage: 0,
            draws: 0,
            abilityCount: 0,
            probabilityCount: 0,
            tearCount: 0,
            cells: Array(9).fill(null),
            opened: false,
	    isDrawing: false // æ–°å¢ï¼šé”å®šçŠ¶æ€
        };

// ä¿®æ”¹åˆå§‹åŒ–ç½‘æ ¼æ–¹æ³•
function initGrid() {
    const grid = document.getElementById('grid');
    if (grid.children.length === 0) {
        for (let i = 0; i < 9; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell hover-effect';
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            if (isTouchDevice) {
                cell.ontouchstart = () => drawCard(i);
            } else {
                cell.onclick = () => drawCard(i);
            }
            grid.appendChild(cell);
        }
    }
}

// æ–°å¢ç½‘æ ¼é‡ç½®æ–¹æ³•
function resetGrid() {
    const cells = document.getElementsByClassName('cell');
    Array.from(cells).forEach((cell, index) => {
        // ä½¿ç”¨requestAnimationFrameä¼˜åŒ–åŠ¨ç”»
        requestAnimationFrame(() => {
            cell.className = 'cell hover-effect';
            cell.innerHTML = '';
            cell.style.cssText = ''; // æ¸…é™¤å†…è”æ ·å¼
        });
    });
}

        // ä¼˜åŒ–åçš„drawCardå‡½æ•°
        async function drawCard(index) {
            if (state.opened || state.cells[index]) return;

            const cell = document.getElementById('grid').children[index];
            
            // ç«‹å³æ·»åŠ ç‚¹å‡»åé¦ˆ
            cell.classList.add('active');
            setTimeout(() => cell.classList.remove('active'), 150);

            // æ·»åŠ åŠ è½½çŠ¶æ€
            cell.classList.add('loading');
            
            // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 50));

            let type;
            // å¤„ç†å¼ºåˆ¶æ’•å¼€é€»è¾‘
            if (state.draws >= 6 && state.tearCount < 2) {
                type = 'tear';
            } else {
                const rand = Math.random() * 100;
                type = rand < 25 ? 'prob-up' : rand < 65 ? 'ability-up' : 'tear';
            }

            // ç§»é™¤åŠ è½½çŠ¶æ€
            cell.classList.remove('loading');

            state.cells[index] = type;
            updateCell(index, type);
            state.draws++;
            
            // æ›´æ–°çŠ¶æ€
            if (type === 'ability-up') {
                if (++state.abilityCount === 2) {
                    state.ability++;
                    state.abilityCount = 0;
                }
            } else if (type === 'prob-up') {
                if (++state.probabilityCount === 2) {
                    state.probabilityStage = Math.min(state.probabilityStage + 1, 3);
                    state.probabilityCount = 0;
                }
            } else if (type === 'tear') {
                if (++state.tearCount === 2) {
                    openPack();
                    return;
                }
            }

            updateDisplay();
            checkForcedTear();
        }

        function checkForcedTear() {
            if (state.draws === 7 && state.tearCount === 0) {
                [7,8].forEach(i => forceTear(i));
            } else if (state.draws === 8 && state.tearCount === 1) {
                forceTear(8);
            }
        }

        // ä¼˜åŒ–å¼ºåˆ¶æ’•å¼€åŠ¨ç”»
        function forceTear(index) {
            if (!state.cells[index]) {
                const cell = document.getElementById('grid').children[index];
                cell.style.transition = 'all 0.3s';
                cell.style.transform = 'scale(1.2)';
                
                setTimeout(() => {
                    cell.style.transform = 'scale(1)';
                    state.cells[index] = 'tear';
                    updateCell(index, 'tear');
                    state.draws++;
                    if (++state.tearCount === 2) openPack();
                }, 300);
            }
        }

        function openPack() {
            state.opened = true;
            const success = Math.random() * 100 < getCurrentProbability();
            let player;

            if (success) {
                const target = state.ability >= 97 ? Math.min(state.ability, 101) : 97;
                const pool = cardPool[target] || [];
                player = pool[Math.floor(Math.random() * pool.length)] || 'æœªçŸ¥çƒå‘˜';
                alert(`æ­å–œä½ ï¼Œè·å¾—${player}ï¼`);
            } else {
                player = currentPlayers[Math.floor(Math.random() * currentPlayers.length)];
                alert(`å¾ˆé—æ†¾ï¼Œä½ æŠ½ä¸­äº†æ™®å¡ï¼ˆ${player}ï¼‰`);
            }
        }

        function getCurrentProbability() {
            const stages = [5, 10, 30, 100];
            return stages[state.probabilityStage];
        }

        // ä¼˜åŒ–åçš„updateCellå‡½æ•°
        function updateCell(index, type) {
            const cell = document.getElementById('grid').children[index];
            cell.className = 'cell disabled ' + type;
            cell.innerHTML = `
                <div style="transform: rotateY(180deg); animation: flipIn 0.4s forwards">
                    ${type === 'prob-up' ? 'æ¦‚ç‡æå‡' : 
                     type === 'ability-up' ? 'èƒ½åŠ›æå‡' : 'æ’•å¼€'}
                </div>
            `;
            
            // æ·»åŠ è§¦è§‰åé¦ˆï¼ˆæ”¯æŒç°ä»£æµè§ˆå™¨ï¼‰
            if (window.navigator.vibrate) {
                navigator.vibrate(30);
            }
        }

        function updateDisplay() {
            document.getElementById('ability').textContent = state.ability;
            document.getElementById('probability').textContent = getCurrentProbability() + '%';
            document.getElementById('draw-count').textContent = state.draws;
        }

        // æ–°å¢ä»“åº“æ•°æ®
        let warehouseHistory = [];

        // ä¿®æ”¹åçš„openPackå‡½æ•°
        function openPack() {
            state.opened = true;
            const success = Math.random() * 100 < getCurrentProbability();
            let player, isSpecial;

            if (success) {
                const target = state.ability >= 97 ? Math.min(state.ability, 101) : 97;
                const pool = cardPool[target] || [];
                player = pool[Math.floor(Math.random() * pool.length)] || 'æœªçŸ¥çƒå‘˜';
                isSpecial = true;
                alert(`æ­å–œä½ ï¼Œè·å¾—${player}ï¼`);
            } else {
                player = currentPlayers[Math.floor(Math.random() * currentPlayers.length)];
                isSpecial = false;
                alert(`å¾ˆé—æ†¾ï¼Œä½ æŠ½ä¸­äº†æ™®å¡ï¼ˆ${player}ï¼‰`);
            }

            // æ·»åŠ è®°å½•åˆ°ä»“åº“
            addToWarehouse(player, isSpecial);
        }

        // æ–°å¢ä»“åº“ç›¸å…³æ–¹æ³•
        function addToWarehouse(player, isSpecial) {
            const record = {
                player: player,
                isSpecial: isSpecial,
                timestamp: new Date().toLocaleString()
            };

            warehouseHistory.unshift(record); // æ·»åŠ åˆ°å¼€å¤´
            if (warehouseHistory.length > 20) {
                warehouseHistory.pop(); // ä¿ç•™æœ€è¿‘20æ¡
            }
            updateWarehouseDisplay();
        }

        function updateWarehouseDisplay() {
            const list = document.getElementById('warehouse-list');
            list.innerHTML = warehouseHistory.map(record => `
                <div class="record-item ${record.isSpecial ? 'golden' : ''}">
                    <span>${record.isSpecial ? 'â­' : 'âš½'} ${record.player}</span>
                    <span class="timestamp">${record.timestamp}</span>
                </div>
            `).join('');
        }


        // ä¿®æ”¹é‡ç½®å‡½æ•°ï¼ˆä¿æŒä»“åº“è®°å½•ï¼‰
        function resetGame() {
   		 // æ·»åŠ ä¸´æ—¶ç±»åé˜²æ­¢é‡å¤ç‚¹å‡»
    	const btn = document.querySelector('button');
    	btn.disabled = true;
    	btn.style.opacity = 0.7;

            state = {
                ability: 96,
                baseProbability: 5,
                probabilityStage: 0,
                draws: 0,
                abilityCount: 0,
                probabilityCount: 0,
                tearCount: 0,
                cells: Array(9).fill(null),
                opened: false
            };

    // ä½¿ç”¨CSS transformä¼˜åŒ–é‡ç½®è¿‡ç¨‹
    const grid = document.getElementById('grid');
    grid.style.transform = 'scale(0.98)';
    grid.style.opacity = 0.8;

    requestAnimationFrame(() => {
        resetGrid();
        updateDisplay();
        grid.style.transform = '';
        grid.style.opacity = '';
        
        // å»¶è¿Ÿæ¢å¤æŒ‰é’®çŠ¶æ€
        setTimeout(() => {
            btn.disabled = false;
            btn.style.opacity = '';
        }, 300);
    });
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        initGrid();
        updateDisplay();
    </script>
</body>
</html>
